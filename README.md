### Telegram / ChatGPT Bot — README

Учебный Telegram-бот на aiogram 3 с интеграцией ChatGPT
---

### Возможности

- Главное меню с инлайн‑кнопками
- Случайный факт с изображением (генерация описания и картинки GPT/DALL·E)
- Чат с ChatGPT (контекстные ответы)
- Диалог с известной личностью (роль/стиль задаются заранее)
- Квиз по темам с подсчётом результата
- Перевод текста на разные языки
- Рекомендации контента по категориям и жанрам

> Под капотом: aiogram v3 (FSM, роутеры), собственная обёртка логирования с ротацией, контроллер «печатает…»/«загрузка…», разнесённые клавиатуры и состояния.

---

### Требования

- Python 3.11+
- Аккаунт Telegram и созданный бот 
- Токен провайдера GPT

---

### Установка и запуск

```bash
# 1) Клонировать репозиторий
git clone https://github.com/ridzuki/tg_bot.git
cd tg_bot

# 2) Установить зависимости
pip install -r requirements.txt

# 3) Настроить переменные окружения (.env в корне)
# См. пример ниже

# 4) Запустить бота
python bot.py
```

---

### Конфигурация (.env)

Создайте файл `.env` в корне проекта и добавьте значения:

```env
TG_TOKEN=ваш_telegram_bot_token
AI_TOKEN=ваш_gpt_api_token
ADMIN_ID=123456789  # ваш Telegram user id (для служебных уведомлений)
```

Файл `config.py` загружает эти переменные через `python-dotenv`.

---

### Как работает

- Точка входа: `bot.py`
  - Инициализирует `Bot`, `Dispatcher`
  - Регистрирует хук на старт/стоп (`misc.on_start`, `misc.on_stop`)
  - Подключает основной роутер `main_router` (см. `handlers`)
  - Запускает `dp.start_polling(bot)`

- Основные обработчики:
  - `handlers/handlers.py`: команда `/start`, показ стартового фото и меню
  - `handlers/inline_handlers.py`: логика инлайн‑кнопок: главное меню, «случайный факт», GPT‑чат, диалог с персонажем, квиз, перевод, рекомендации.

- Клавиатуры и callback‑данные:
  - `keyboards/…`, `keyboards/callback_data.py`

- GPT интеграция:
  - `ai/` (`ai/gpt_client.py`, `ai/messages.py`, `ai/chat_gpt`), использует `openai`

- Вспомогательные утилиты:
  - `utils/loading.py` — «анимация» загрузки и статус «печатает…» 
  - `utils/builder.py` — сборка карт тем/жанров из файлов
  - `utils/file_manager.py`, `utils/enum_path.py` — работа с файлами и путями к ресурсам

- Логирование:
  - `logger.py` — настраиваемый `logging` с ротацией (`logs/bot.log`), формат с полями `feature`, `user_id`, `request_id`

---

### Управление и сценарии

- Запуск: `/start` → приходит карточка с фото и инлайн‑меню
- Кнопки меню (основные):
  - «Случайный факт»: бот генерирует факт, рисует/получает картинку и присылает карточку
  - «ChatGPT»: обычный диалог с моделью (контекст хранится в FSM)
  - «Поговорить»: выбор «известной личности», диалог в стиле выбранной личности
  - «Квиз»: выбрать тему и пройти мини‑тест
  - «Перевести»: выбрать язык и отправить текст для перевода
  - «Рекомендации»: выбрать категорию/жанр, получить совет; можно дизлайкнуть — выдаст альтернативу

Подтверждающие/отменяющие действия и «Назад» реализованы инлайн‑кнопками (см. `keyboards/inl_keyboards.py`).

---

### Структура проекта

```text
tg_bot/
  ai/
  handlers/
  keyboards/
  utils/
  bot.py
  config.py
  logger.py
  requirements.txt
  README.md
```

---

### Частые вопросы

- Где хранятся логи?
  - В папке `logs/` (создаётся автоматически), ротация — ежедневно, хранение ~14 дней.

- Что если бот не запускается?
  - Проверьте `.env` и актуальность токенов
  - Убедитесь, что используете Python 3.11+
  - Установите зависимости `pip install -r requirements.txt`

---

### Лицензия

Учебный проект. Используйте свободно с указанием автора/ссылки на репозиторий.
